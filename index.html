<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ğŸ§  ìƒì‹ í€´ì¦ˆ</title>
<link href="https://fonts.googleapis.com/css2?family=Black+Han+Sans&family=Noto+Sans+KR:wght@400;500;700;900&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#0e0e1c;--card:#181830;--card2:#1f1f3a;
  --accent:#ffe156;--accent2:#ff6b8a;--accent3:#5be0ff;
  --green:#4dffc3;--red:#ff4d6d;--text:#f2f2ff;--muted:#7777aa;
  --border:rgba(255,255,255,0.08);--radius:18px;
}
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent;}
body{background:var(--bg);color:var(--text);font-family:'Noto Sans KR',sans-serif;min-height:100dvh;display:flex;flex-direction:column;align-items:center;justify-content:center;overflow:hidden;position:relative;}
.bg-orb{position:fixed;border-radius:50%;filter:blur(90px);opacity:.13;pointer-events:none;animation:orbFloat 9s ease-in-out infinite;}
.bg-orb1{width:380px;height:380px;background:#4040ff;top:-120px;left:-120px;}
.bg-orb2{width:300px;height:300px;background:#ff3d70;bottom:-100px;right:-80px;animation-delay:-4s;}
.bg-orb3{width:220px;height:220px;background:#00cfff;top:45%;left:55%;animation-delay:-7s;}
@keyframes orbFloat{0%,100%{transform:translateY(0)scale(1);}50%{transform:translateY(-22px)scale(1.05);}}

/* â”€â”€ SCREENS â”€â”€ */
.screen{display:none;width:100%;max-width:480px;padding:18px 16px;flex-direction:column;align-items:center;gap:14px;overflow-y:auto;max-height:100dvh;scrollbar-width:none;}
.screen::-webkit-scrollbar{display:none;}
.screen.active{display:flex;animation:fadeUp .32s ease;}
@keyframes fadeUp{from{opacity:0;transform:translateY(16px);}to{opacity:1;transform:translateY(0);}}

/* â”€â”€ COMMON â”€â”€ */
.title-badge{background:linear-gradient(135deg,var(--accent),#ff9d00);color:#000;font-family:'Black Han Sans',sans-serif;font-size:12px;letter-spacing:3px;padding:5px 16px;border-radius:999px;}
h1{font-family:'Black Han Sans',sans-serif;font-size:clamp(32px,9vw,50px);text-align:center;background:linear-gradient(135deg,#fff 30%,var(--accent3));-webkit-background-clip:text;-webkit-text-fill-color:transparent;line-height:1.1;}
.subtitle{color:var(--muted);font-size:13px;text-align:center;}
.divider{width:100%;height:1px;background:var(--border);}
.section-label{font-size:11px;font-weight:700;letter-spacing:2px;color:var(--muted);text-transform:uppercase;width:100%;margin-bottom:-4px;}
.card-box{width:100%;background:var(--card);border:1.5px solid var(--border);border-radius:var(--radius);padding:14px;}

/* â”€â”€ SETTING OPTS â”€â”€ */
.btn-group{display:flex;gap:7px;width:100%;}
.btn-opt{flex:1;padding:11px 4px;border-radius:12px;border:2px solid var(--border);background:var(--card);color:var(--muted);font-family:'Noto Sans KR',sans-serif;font-size:12px;font-weight:700;cursor:pointer;transition:all .18s;display:flex;flex-direction:column;align-items:center;gap:2px;}
.btn-opt .oi{font-size:18px;}.btn-opt .os{font-size:10px;font-weight:400;opacity:.7;}
.btn-opt:hover{border-color:var(--accent);color:var(--accent);}
.btn-opt.selected{border-color:var(--accent);background:rgba(255,225,86,.1);color:var(--accent);box-shadow:0 0 14px rgba(255,225,86,.16);}

/* category scroll */
.cat-scroll{width:100%;display:flex;gap:7px;overflow-x:auto;padding-bottom:2px;scrollbar-width:none;}
.cat-scroll::-webkit-scrollbar{display:none;}
.cat-chip{flex-shrink:0;padding:9px 14px;border-radius:12px;border:2px solid var(--border);background:var(--card);color:var(--muted);font-family:'Noto Sans KR',sans-serif;font-size:12px;font-weight:700;cursor:pointer;transition:all .18s;white-space:nowrap;}
.cat-chip:hover{border-color:var(--accent3);color:var(--accent3);}
.cat-chip.selected{border-color:var(--accent3);background:rgba(91,224,255,.1);color:var(--accent3);}
.cat-chip.all-chip.selected{border-color:var(--accent);background:rgba(255,225,86,.1);color:var(--accent);}

/* HOME BTNS */
.home-btns{width:100%;display:flex;flex-direction:column;gap:9px;}
.btn-start{width:100%;padding:15px;border-radius:var(--radius);border:none;background:linear-gradient(135deg,var(--accent),#ff9d00);color:#111;font-family:'Black Han Sans',sans-serif;font-size:18px;letter-spacing:2px;cursor:pointer;transition:all .2s;box-shadow:0 8px 26px rgba(255,225,86,.28);}
.btn-start:hover{transform:translateY(-2px);}
.btn-secondary{width:100%;padding:12px;border-radius:var(--radius);border:2px solid var(--border);background:var(--card);color:var(--muted);font-family:'Noto Sans KR',sans-serif;font-size:13px;font-weight:700;cursor:pointer;transition:all .2s;}
.btn-secondary:hover{border-color:var(--accent3);color:var(--accent3);}

/* TTS box */
.tts-row{display:flex;align-items:center;gap:8px;}
.tts-row select{flex:1;background:var(--card2);border:1.5px solid var(--border);border-radius:8px;color:var(--text);font-family:'Noto Sans KR',sans-serif;font-size:12px;padding:6px 8px;cursor:pointer;outline:none;}
.tts-row select:focus{border-color:var(--accent3);}
.btn-sm{padding:6px 12px;border-radius:8px;border:1.5px solid var(--accent3);background:transparent;color:var(--accent3);font-size:11px;font-weight:700;cursor:pointer;transition:all .2s;white-space:nowrap;}
.btn-sm:hover{background:rgba(91,224,255,.1);}
.btn-sm.red{border-color:var(--red);color:var(--red);}
.btn-sm.red:hover{background:rgba(255,77,109,.1);}
.btn-sm.green{border-color:var(--green);color:var(--green);}
.btn-sm.green:hover{background:rgba(77,255,195,.1);}

/* â”€â”€ QUIZ â”€â”€ */
#screen-quiz{gap:11px;justify-content:flex-start;padding-top:16px;}
.quiz-header{width:100%;display:flex;align-items:center;justify-content:space-between;gap:10px;}
.quiz-progress-wrap{flex:1;}
.progress-info{display:flex;justify-content:space-between;font-size:11px;color:var(--muted);margin-bottom:5px;}
.progress-bar{height:5px;background:var(--card2);border-radius:99px;overflow:hidden;}
.progress-fill{height:100%;background:linear-gradient(90deg,var(--accent3),var(--accent));border-radius:99px;transition:width .5s ease;}
.btn-pause{width:42px;height:42px;border-radius:50%;border:2px solid var(--border);background:var(--card);color:var(--text);font-size:16px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s;flex-shrink:0;}
.btn-pause:hover{border-color:var(--accent3);color:var(--accent3);}
.question-card{width:100%;background:var(--card);border-radius:20px;padding:20px 16px;border:1.5px solid var(--border);position:relative;overflow:hidden;}
.question-card::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(90deg,var(--accent3),var(--accent));}
.q-meta{display:flex;align-items:center;gap:7px;margin-bottom:11px;flex-wrap:wrap;}
.q-num{background:linear-gradient(135deg,var(--accent3),#0099cc);color:#000;font-weight:900;font-size:11px;padding:3px 10px;border-radius:99px;}
.q-cat-badge{font-size:10px;font-weight:700;padding:3px 9px;border-radius:99px;background:rgba(255,225,86,.15);color:var(--accent);}
.q-diff-badge{font-size:10px;font-weight:700;padding:3px 9px;border-radius:99px;}
.diff-easy{background:rgba(77,255,195,.15);color:var(--green);}
.diff-mid{background:rgba(91,224,255,.15);color:var(--accent3);}
.diff-hard{background:rgba(255,77,109,.15);color:var(--red);}
.q-text{font-size:clamp(15px,4vw,20px);font-weight:700;line-height:1.55;color:#fff;}
.timer-wrap{display:flex;flex-direction:column;align-items:center;gap:5px;}
.timer-label{font-size:11px;color:var(--muted);letter-spacing:1px;text-transform:uppercase;}
.timer-ring-outer{width:76px;height:76px;position:relative;}
.timer-ring-outer svg{transform:rotate(-90deg);}
.timer-bg{fill:none;stroke:var(--card2);stroke-width:6;}
.timer-arc{fill:none;stroke:var(--accent);stroke-width:6;stroke-linecap:round;transition:stroke-dashoffset .9s linear,stroke .3s;}
.timer-number{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-family:'Black Han Sans',sans-serif;font-size:24px;color:var(--accent);}
.choices{width:100%;display:flex;flex-direction:column;gap:7px;}
.choice-btn{width:100%;padding:12px 15px;border-radius:13px;border:2px solid var(--border);background:var(--card);color:var(--text);font-family:'Noto Sans KR',sans-serif;font-size:13px;font-weight:500;text-align:left;cursor:pointer;transition:all .2s;display:flex;align-items:center;gap:10px;}
.choice-letter{width:26px;height:26px;border-radius:50%;flex-shrink:0;background:var(--card2);color:var(--muted);display:flex;align-items:center;justify-content:center;font-weight:700;font-size:12px;transition:all .2s;}
.choice-btn:hover:not(:disabled){border-color:var(--accent3);color:#fff;transform:translateX(3px);}
.choice-btn:hover:not(:disabled) .choice-letter{background:var(--accent3);color:#000;}
.choice-btn.correct{border-color:var(--green)!important;background:rgba(77,255,195,.1)!important;color:var(--green)!important;}
.choice-btn.correct .choice-letter{background:var(--green)!important;color:#000!important;}
.choice-btn.wrong{border-color:var(--red)!important;background:rgba(255,77,109,.1)!important;color:var(--red)!important;}
.choice-btn.wrong .choice-letter{background:var(--red)!important;color:#fff!important;}
.choice-btn:disabled{cursor:default;}
.short-answer-wrap{width:100%;display:flex;flex-direction:column;align-items:center;}
.answer-reveal{width:100%;padding:16px;border-radius:13px;border:2px solid var(--border);background:var(--card);text-align:center;font-size:19px;font-weight:700;color:var(--muted);letter-spacing:4px;transition:all .5s;}
.answer-reveal.shown{border-color:var(--green);background:rgba(77,255,195,.1);color:var(--green);letter-spacing:1px;}
.status-banner{width:100%;padding:11px 16px;border-radius:12px;text-align:center;font-weight:700;font-size:14px;animation:popIn .28s cubic-bezier(.2,1.5,.5,1);display:none;}
.status-banner.correct-banner{background:rgba(77,255,195,.13);color:var(--green);border:1.5px solid rgba(77,255,195,.25);}
.status-banner.wrong-banner{background:rgba(255,77,109,.13);color:var(--red);border:1.5px solid rgba(255,77,109,.25);}
.status-banner.info-banner{background:rgba(91,224,255,.1);color:var(--accent3);border:1.5px solid rgba(91,224,255,.2);}
@keyframes popIn{from{transform:scale(.88);opacity:0;}to{transform:scale(1);opacity:1;}}
.btn-next{width:100%;padding:14px;border-radius:13px;border:none;background:linear-gradient(135deg,var(--accent3),#0088cc);color:#000;font-family:'Black Han Sans',sans-serif;font-size:15px;cursor:pointer;transition:all .2s;box-shadow:0 5px 18px rgba(91,224,255,.25);display:none;}
.btn-next:hover{transform:translateY(-2px);}
.tts-status{display:flex;align-items:center;gap:5px;font-size:11px;color:var(--muted);}
.tts-dot{width:7px;height:7px;border-radius:50%;background:var(--muted);transition:background .3s;}
.tts-dot.speaking{background:var(--green);animation:blink .7s infinite;}
@keyframes blink{0%,100%{opacity:1;}50%{opacity:.3;}}

/* â”€â”€ PAUSE â”€â”€ */
#pause-overlay{display:none;position:fixed;inset:0;background:rgba(8,8,18,.9);backdrop-filter:blur(14px);z-index:100;flex-direction:column;align-items:center;justify-content:center;gap:16px;}
#pause-overlay.active{display:flex;}
.pause-icon{font-size:52px;animation:pulse 2s infinite;}
@keyframes pulse{0%,100%{transform:scale(1);}50%{transform:scale(1.1);}}
.pause-text{font-family:'Black Han Sans',sans-serif;font-size:24px;color:var(--accent);}
.btn-resume{padding:13px 34px;border-radius:999px;border:none;background:linear-gradient(135deg,var(--accent),#ff9d00);color:#000;font-family:'Black Han Sans',sans-serif;font-size:16px;cursor:pointer;box-shadow:0 8px 24px rgba(255,225,86,.38);transition:all .2s;}
.btn-resume:hover{transform:scale(1.04);}

/* â”€â”€ RESULT â”€â”€ */
#screen-result{text-align:center;gap:13px;}
.result-emoji{font-size:68px;animation:bounce .6s ease;}
@keyframes bounce{0%{transform:scale(0);}60%{transform:scale(1.2);}100%{transform:scale(1);}}
.result-title{font-family:'Black Han Sans',sans-serif;font-size:25px;}
.result-score{font-family:'Black Han Sans',sans-serif;font-size:52px;background:linear-gradient(135deg,var(--accent),#ff9d00);-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
.result-sub{color:var(--muted);font-size:13px;}
.result-stats{width:100%;display:flex;gap:8px;}
.stat-card{flex:1;background:var(--card);border-radius:13px;padding:13px 6px;border:1.5px solid var(--border);display:flex;flex-direction:column;align-items:center;gap:3px;}
.stat-val{font-size:22px;font-weight:900;}.stat-lab{font-size:10px;color:var(--muted);}
.stat-correct .stat-val{color:var(--green);}.stat-wrong .stat-val{color:var(--red);}.stat-pct .stat-val{color:var(--accent);}
.btn-restart{width:100%;padding:14px;border-radius:var(--radius);border:none;background:linear-gradient(135deg,var(--accent),#ff9d00);color:#000;font-family:'Black Han Sans',sans-serif;font-size:16px;cursor:pointer;transition:all .2s;box-shadow:0 8px 24px rgba(255,225,86,.28);}
.btn-restart:hover{transform:translateY(-2px);}

/* â”€â”€ EDITOR â”€â”€ */
#screen-editor{gap:12px;justify-content:flex-start;padding-top:14px;}
.page-header{width:100%;display:flex;align-items:center;gap:11px;}
.btn-back{width:38px;height:38px;border-radius:50%;border:2px solid var(--border);background:var(--card);color:var(--text);font-size:17px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s;flex-shrink:0;}
.btn-back:hover{border-color:var(--accent);color:var(--accent);}
.page-title{font-family:'Black Han Sans',sans-serif;font-size:19px;flex:1;}

/* Category bar in editor */
.editor-cat-bar{width:100%;display:flex;gap:7px;overflow-x:auto;scrollbar-width:none;padding-bottom:2px;}
.editor-cat-bar::-webkit-scrollbar{display:none;}
.editor-cat-tag{flex-shrink:0;padding:7px 12px;border-radius:10px;border:2px solid var(--border);background:var(--card);color:var(--muted);font-size:12px;font-weight:700;cursor:pointer;transition:all .18s;white-space:nowrap;display:flex;align-items:center;gap:5px;}
.editor-cat-tag:hover{border-color:var(--accent3);color:var(--accent3);}
.editor-cat-tag.active{border-color:var(--accent3);background:rgba(91,224,255,.1);color:var(--accent3);}
.editor-cat-tag .del-tag{font-size:13px;opacity:.6;transition:opacity .15s;cursor:pointer;}
.editor-cat-tag .del-tag:hover{opacity:1;color:var(--red);}
.btn-add-cat{flex-shrink:0;padding:7px 12px;border-radius:10px;border:2px dashed var(--border);background:transparent;color:var(--muted);font-size:12px;font-weight:700;cursor:pointer;transition:all .2s;white-space:nowrap;}
.btn-add-cat:hover{border-color:var(--accent);color:var(--accent);}

/* Diff tabs */
.diff-tabs{width:100%;display:flex;gap:6px;}
.diff-tab{flex:1;padding:8px 4px;border-radius:10px;border:2px solid var(--border);background:var(--card);color:var(--muted);font-size:11px;font-weight:700;cursor:pointer;transition:all .18s;text-align:center;}
.diff-tab.active{border-color:var(--accent);background:rgba(255,225,86,.08);color:var(--accent);}

/* Question list */
.question-list{width:100%;display:flex;flex-direction:column;gap:8px;}
.q-item{width:100%;background:var(--card);border:1.5px solid var(--border);border-radius:14px;padding:12px 12px;display:flex;align-items:flex-start;gap:9px;transition:border-color .18s;}
.q-item:hover{border-color:rgba(255,255,255,.13);}
.q-item-num{min-width:24px;height:24px;border-radius:50%;background:var(--card2);color:var(--muted);display:flex;align-items:center;justify-content:center;font-size:10px;font-weight:700;flex-shrink:0;margin-top:2px;}
.q-item-body{flex:1;min-width:0;}
.q-item-q{font-size:13px;font-weight:600;color:var(--text);margin-bottom:4px;line-height:1.4;word-break:break-all;}
.q-item-meta{display:flex;gap:6px;align-items:center;flex-wrap:wrap;}
.q-item-a{font-size:11px;color:var(--green);font-weight:600;}
.q-item-cat{font-size:10px;color:var(--accent);background:rgba(255,225,86,.1);padding:2px 7px;border-radius:6px;}
.q-item-diff{font-size:10px;padding:2px 7px;border-radius:6px;}
.q-item-diff.easy{background:rgba(77,255,195,.1);color:var(--green);}
.q-item-diff.mid{background:rgba(91,224,255,.1);color:var(--accent3);}
.q-item-diff.hard{background:rgba(255,77,109,.1);color:var(--red);}
.q-item-actions{display:flex;gap:5px;flex-shrink:0;}
.btn-icon{width:28px;height:28px;border-radius:7px;border:1.5px solid var(--border);background:transparent;color:var(--muted);font-size:12px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .18s;}
.btn-icon:hover{border-color:var(--accent3);color:var(--accent3);}
.btn-icon.del:hover{border-color:var(--red);color:var(--red);}
.btn-add-q{width:100%;padding:12px;border-radius:13px;border:2px dashed var(--border);background:transparent;color:var(--muted);font-family:'Noto Sans KR',sans-serif;font-size:13px;font-weight:700;cursor:pointer;transition:all .2s;}
.btn-add-q:hover{border-color:var(--accent);color:var(--accent);background:rgba(255,225,86,.04);}
.empty-state{text-align:center;color:var(--muted);font-size:13px;padding:22px 0;}
.empty-icon{font-size:34px;margin-bottom:7px;}

/* â”€â”€ BACKUP SCREEN â”€â”€ */
#screen-backup{gap:13px;justify-content:flex-start;padding-top:14px;}
.backup-section{width:100%;display:flex;flex-direction:column;gap:9px;}
.backup-card{width:100%;background:var(--card);border:1.5px solid var(--border);border-radius:var(--radius);padding:16px;display:flex;flex-direction:column;gap:10px;}
.backup-card-title{font-size:13px;font-weight:700;color:var(--text);}
.backup-card-desc{font-size:12px;color:var(--muted);line-height:1.5;}
.backup-btns{display:flex;gap:8px;flex-wrap:wrap;}
.btn-backup{flex:1;min-width:120px;padding:11px 14px;border-radius:11px;border:none;font-family:'Noto Sans KR',sans-serif;font-size:13px;font-weight:700;cursor:pointer;transition:all .2s;text-align:center;}
.btn-export{background:linear-gradient(135deg,var(--accent3),#0088cc);color:#000;}
.btn-export:hover{opacity:.88;}
.btn-import{background:var(--card2);border:1.5px solid var(--border);color:var(--text);}
.btn-import:hover{border-color:var(--accent3);color:var(--accent3);}
.btn-reset{background:rgba(255,77,109,.15);border:1.5px solid rgba(255,77,109,.3);color:var(--red);}
.btn-reset:hover{background:rgba(255,77,109,.25);}
.share-url-wrap{display:flex;flex-direction:column;gap:7px;}
.share-url-box{background:var(--card2);border:1.5px solid var(--border);border-radius:10px;padding:10px 12px;font-size:11px;color:var(--muted);word-break:break-all;line-height:1.5;max-height:80px;overflow-y:auto;}
.stats-grid{display:grid;grid-template-columns:1fr 1fr;gap:7px;}
.stats-item{background:var(--card2);border-radius:10px;padding:10px;display:flex;flex-direction:column;gap:2px;}
.stats-val{font-size:20px;font-weight:900;color:var(--accent);}
.stats-key{font-size:10px;color:var(--muted);}

/* â”€â”€ MODAL â”€â”€ */
#modal-overlay{display:none;position:fixed;inset:0;background:rgba(8,8,18,.9);backdrop-filter:blur(10px);z-index:200;align-items:flex-end;justify-content:center;padding:0;}
#modal-overlay.active{display:flex;}
.modal-box{width:100%;max-width:480px;background:#191930;border:1.5px solid rgba(255,255,255,.09);border-radius:22px 22px 0 0;padding:20px 16px 28px;display:flex;flex-direction:column;gap:13px;max-height:92dvh;overflow-y:auto;animation:slideUp .3s ease;}
@keyframes slideUp{from{transform:translateY(100%);}to{transform:translateY(0);}}
.modal-title{font-family:'Black Han Sans',sans-serif;font-size:17px;color:var(--accent);}
.form-group{display:flex;flex-direction:column;gap:5px;}
.form-label{font-size:11px;font-weight:700;letter-spacing:1.5px;color:var(--muted);text-transform:uppercase;}
.form-input,.form-select,.form-textarea{width:100%;background:var(--card2);border:1.5px solid var(--border);border-radius:9px;color:var(--text);font-family:'Noto Sans KR',sans-serif;font-size:13px;padding:9px 11px;outline:none;transition:border-color .2s;resize:vertical;}
.form-input:focus,.form-select:focus,.form-textarea:focus{border-color:var(--accent3);}
.form-textarea{min-height:56px;}
.choices-grid{display:flex;flex-direction:column;gap:6px;}
.choice-row{display:flex;align-items:center;gap:7px;}
.choice-row label{font-size:12px;font-weight:700;color:var(--muted);min-width:18px;cursor:pointer;}
.choice-row input[type=radio]{accent-color:var(--green);width:15px;height:15px;cursor:pointer;flex-shrink:0;}
.modal-btns{display:flex;gap:8px;}
.btn-modal-cancel{flex:1;padding:12px;border-radius:10px;border:2px solid var(--border);background:transparent;color:var(--muted);font-family:'Noto Sans KR',sans-serif;font-size:13px;font-weight:700;cursor:pointer;transition:all .2s;}
.btn-modal-cancel:hover{border-color:var(--red);color:var(--red);}
.btn-modal-save{flex:2;padding:12px;border-radius:10px;border:none;background:linear-gradient(135deg,var(--accent),#ff9d00);color:#000;font-family:'Black Han Sans',sans-serif;font-size:14px;cursor:pointer;transition:all .2s;}
.btn-modal-save:hover{opacity:.9;}
.form-hint{font-size:11px;color:var(--muted);margin-top:2px;}

/* toast */
#toast{position:fixed;bottom:30px;left:50%;transform:translateX(-50%) translateY(20px);background:#222240;border:1.5px solid var(--border);border-radius:999px;padding:10px 20px;font-size:13px;font-weight:600;color:var(--text);opacity:0;transition:all .3s;pointer-events:none;z-index:999;white-space:nowrap;}
#toast.show{opacity:1;transform:translateX(-50%) translateY(0);}
</style>
</head>
<body>
<div class="bg-orb bg-orb1"></div>
<div class="bg-orb bg-orb2"></div>
<div class="bg-orb bg-orb3"></div>
<div id="toast"></div>

<!-- â•â•â•â•â•â•â•â• HOME â•â•â•â•â•â•â•â• -->
<div id="screen-home" class="screen active">
  <div class="title-badge">âœ¨ QUIZ TIME</div>
  <h1>ìƒì‹<br>í€´ì¦ˆ</h1>
  <p class="subtitle">ì°¨ ì•ˆì—ì„œ ì¦ê¸°ëŠ” ë‘ë‡Œ í›ˆë ¨!</p>
  <div class="divider"></div>

  <!-- ì¹´í…Œê³ ë¦¬ -->
  <div class="section-label">ğŸ“‚ ë¬¸ì œ ìœ í˜•</div>
  <div class="cat-scroll" id="home-cat-scroll"><!-- JS --></div>

  <!-- ë‚œì´ë„ -->
  <div class="section-label">ğŸ¯ ë‚œì´ë„</div>
  <div class="btn-group">
    <button class="btn-opt selected" data-group="diff" data-val="all"><span class="oi">ğŸ²</span>ì „ì²´<span class="os">ëª¨ë‘</span></button>
    <button class="btn-opt" data-group="diff" data-val="easy"><span class="oi">ğŸ˜Š</span>ì‰¬ì›€<span class="os">ì´ˆë“±</span></button>
    <button class="btn-opt" data-group="diff" data-val="mid"><span class="oi">ğŸ¤”</span>ë³´í†µ<span class="os">ì¤‘ë“±</span></button>
    <button class="btn-opt" data-group="diff" data-val="hard"><span class="oi">ğŸ”¥</span>ì–´ë ¤ì›€<span class="os">ê³ ë“±</span></button>
  </div>

  <!-- ëŒ€ê¸°ì‹œê°„ -->
  <div class="section-label">â± ëŒ€ê¸° ì‹œê°„</div>
  <div class="btn-group">
    <button class="btn-opt selected" data-group="wait" data-val="3"><span class="oi">âš¡</span>3ì´ˆ<span class="os">ë¹ ë¦„</span></button>
    <button class="btn-opt" data-group="wait" data-val="5"><span class="oi">â³</span>5ì´ˆ<span class="os">ë³´í†µ</span></button>
    <button class="btn-opt" data-group="wait" data-val="10"><span class="oi">ğŸ¢</span>10ì´ˆ<span class="os">ì—¬ìœ </span></button>
  </div>

  <!-- ì •ë‹µë°©ì‹ -->
  <div class="section-label">ğŸ“ ì •ë‹µ ë°©ì‹</div>
  <div class="btn-group">
    <button class="btn-opt selected" data-group="type" data-val="multi"><span class="oi">ğŸ”¢</span>ì‚¬ì§€ì„ ë‹¤<span class="os">ë³´ê¸° 4ê°œ</span></button>
    <button class="btn-opt" data-group="type" data-val="short"><span class="oi">âœï¸</span>ë‹¨ë‹µí˜•<span class="os">ì§ì ‘ ìƒê°</span></button>
  </div>

  <!-- ìŒì„± -->
  <div class="card-box">
    <div class="section-label" style="margin-bottom:8px">ğŸ”Š ìŒì„± ì„ íƒ</div>
    <div class="tts-row">
      <select id="voice-select"><option>ë¡œë”© ì¤‘...</option></select>
      <button class="btn-sm" onclick="testVoice()">í…ŒìŠ¤íŠ¸</button>
    </div>
  </div>

  <div class="home-btns">
    <button class="btn-start" onclick="startQuiz()">í€´ì¦ˆ ì‹œì‘í•˜ê¸° ğŸš€</button>
    <div style="display:flex;gap:8px;width:100%">
      <button class="btn-secondary" style="flex:1" onclick="showScreen('screen-editor')">âœï¸ ë¬¸ì œ í¸ì§‘</button>
      <button class="btn-secondary" style="flex:1" onclick="showScreen('screen-backup')">ğŸ’¾ ë°±ì—…/ê³µìœ </button>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â• QUIZ â•â•â•â•â•â•â•â• -->
<div id="screen-quiz" class="screen">
  <div class="quiz-header">
    <div class="quiz-progress-wrap">
      <div class="progress-info">
        <span id="progress-text">1 / 10</span>
        <div class="tts-status"><div class="tts-dot" id="tts-dot"></div><span id="tts-label">ëŒ€ê¸° ì¤‘</span></div>
      </div>
      <div class="progress-bar"><div class="progress-fill" id="progress-fill" style="width:0%"></div></div>
    </div>
    <button class="btn-pause" id="btn-pause" onclick="togglePause()">â¸</button>
  </div>
  <div class="question-card">
    <div class="q-meta">
      <span class="q-num" id="q-num">Q1</span>
      <span class="q-cat-badge" id="q-cat-badge"></span>
      <span class="q-diff-badge diff-easy" id="q-diff-badge">ì‰¬ì›€</span>
    </div>
    <div class="q-text" id="q-text">ë¬¸ì œ ë¡œë”© ì¤‘...</div>
  </div>
  <div class="timer-wrap">
    <div class="timer-label" id="timer-phase-label">ë¬¸ì œ ì½ëŠ” ì¤‘</div>
    <div class="timer-ring-outer">
      <svg width="76" height="76" viewBox="0 0 76 76">
        <circle class="timer-bg" cx="38" cy="38" r="31"/>
        <circle class="timer-arc" id="timer-arc" cx="38" cy="38" r="31" stroke-dasharray="194.78" stroke-dashoffset="0"/>
      </svg>
      <div class="timer-number" id="timer-number">â€“</div>
    </div>
  </div>
  <div class="choices" id="choices-wrap">
    <button class="choice-btn" id="c0" onclick="selectChoice(0)"><span class="choice-letter">â‘ </span><span class="choice-text"></span></button>
    <button class="choice-btn" id="c1" onclick="selectChoice(1)"><span class="choice-letter">â‘¡</span><span class="choice-text"></span></button>
    <button class="choice-btn" id="c2" onclick="selectChoice(2)"><span class="choice-letter">â‘¢</span><span class="choice-text"></span></button>
    <button class="choice-btn" id="c3" onclick="selectChoice(3)"><span class="choice-letter">â‘£</span><span class="choice-text"></span></button>
  </div>
  <div class="short-answer-wrap" id="short-wrap" style="display:none">
    <div class="answer-reveal" id="answer-reveal">? ? ?</div>
  </div>
  <div class="status-banner" id="status-banner"></div>
  <button class="btn-next" id="btn-next" onclick="nextQuestion()">ë‹¤ìŒ ë¬¸ì œ â†’</button>
</div>

<!-- PAUSE -->
<div id="pause-overlay">
  <div class="pause-icon">â¸ï¸</div>
  <div class="pause-text">ì¼ì‹œì •ì§€</div>
  <button class="btn-resume" onclick="togglePause()">â–¶ ê³„ì†í•˜ê¸°</button>
</div>

<!-- â•â•â•â•â•â•â•â• RESULT â•â•â•â•â•â•â•â• -->
<div id="screen-result" class="screen">
  <div class="result-emoji" id="result-emoji">ğŸ†</div>
  <div class="result-title">í€´ì¦ˆ ì™„ë£Œ!</div>
  <div class="result-score" id="result-score">0ì </div>
  <div class="result-sub" id="result-sub">ìˆ˜ê³ í•˜ì…¨ìŠµë‹ˆë‹¤</div>
  <div class="result-stats">
    <div class="stat-card stat-correct"><div class="stat-val" id="stat-correct">0</div><div class="stat-lab">ì •ë‹µ</div></div>
    <div class="stat-card stat-wrong"><div class="stat-val" id="stat-wrong">0</div><div class="stat-lab">ì˜¤ë‹µ</div></div>
    <div class="stat-card stat-pct"><div class="stat-val" id="stat-pct">0%</div><div class="stat-lab">ì •í™•ë„</div></div>
  </div>
  <button class="btn-restart" onclick="restartQuiz()">ğŸ”„ ë‹¤ì‹œ ì‹œì‘</button>
</div>

<!-- â•â•â•â•â•â•â•â• EDITOR â•â•â•â•â•â•â•â• -->
<div id="screen-editor" class="screen">
  <div class="page-header">
    <button class="btn-back" onclick="showScreen('screen-home')">â†</button>
    <div class="page-title">ë¬¸ì œ í¸ì§‘</div>
    <button class="btn-sm" onclick="openAddCatModal()">ï¼‹ ìœ í˜• ì¶”ê°€</button>
  </div>

  <!-- ì¹´í…Œê³ ë¦¬ íƒ­ -->
  <div class="editor-cat-bar" id="editor-cat-bar"><!-- JS --></div>

  <!-- ë‚œì´ë„ í•„í„° -->
  <div class="diff-tabs">
    <button class="diff-tab active" data-ediff="all" onclick="switchEdDiff('all')">ì „ì²´</button>
    <button class="diff-tab" data-ediff="easy" onclick="switchEdDiff('easy')">ğŸ˜Š ì‰¬ì›€</button>
    <button class="diff-tab" data-ediff="mid" onclick="switchEdDiff('mid')">ğŸ¤” ë³´í†µ</button>
    <button class="diff-tab" data-ediff="hard" onclick="switchEdDiff('hard')">ğŸ”¥ ì–´ë ¤ì›€</button>
  </div>

  <div class="question-list" id="editor-list"></div>
  <button class="btn-add-q" onclick="openModal(null)">ï¼‹ ìƒˆ ë¬¸ì œ ì¶”ê°€</button>
  <div style="height:6px"></div>
</div>

<!-- â•â•â•â•â•â•â•â• BACKUP â•â•â•â•â•â•â•â• -->
<div id="screen-backup" class="screen">
  <div class="page-header">
    <button class="btn-back" onclick="showScreen('screen-home')">â†</button>
    <div class="page-title">ë°±ì—… / ê³µìœ </div>
  </div>

  <!-- í†µê³„ -->
  <div class="backup-section">
    <div class="section-label">ğŸ“Š í˜„ì¬ ë¬¸ì œ í†µê³„</div>
    <div class="stats-grid" id="stats-grid"><!-- JS --></div>
  </div>

  <!-- ë‚´ë³´ë‚´ê¸° -->
  <div class="backup-card">
    <div class="backup-card-title">ğŸ“¤ ë‚´ë³´ë‚´ê¸° (ë‹¤ë¥¸ ê¸°ê¸°ë¡œ ì „ì†¡)</div>
    <div class="backup-card-desc">JSON íŒŒì¼ë¡œ ì €ì¥í•˜ê±°ë‚˜, URLë¡œ ì¸ì½”ë”©í•´ì„œ ë‹¤ë¥¸ ê¸°ê¸°ì—ì„œ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ìˆì–´ìš”.</div>
    <div class="backup-btns">
      <button class="btn-backup btn-export" onclick="exportJSON()">ğŸ“ JSON íŒŒì¼ ì €ì¥</button>
      <button class="btn-backup btn-import" onclick="genShareURL()">ğŸ”— ê³µìœ  URL ìƒì„±</button>
    </div>
    <div class="share-url-wrap" id="share-url-wrap" style="display:none">
      <div class="form-label">ê³µìœ  URL (ë³µì‚¬í•´ì„œ ì „ì†¡)</div>
      <div class="share-url-box" id="share-url-box"></div>
      <button class="btn-sm" onclick="copyShareURL()">ğŸ“‹ URL ë³µì‚¬</button>
    </div>
  </div>

  <!-- ê°€ì ¸ì˜¤ê¸° -->
  <div class="backup-card">
    <div class="backup-card-title">ğŸ“¥ ê°€ì ¸ì˜¤ê¸°</div>
    <div class="backup-card-desc">ì €ì¥ëœ JSON íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¤ê±°ë‚˜, ê³µìœ  URLì„ ë¶™ì—¬ë„£ê¸° í•˜ì„¸ìš”.<br>âš ï¸ í˜„ì¬ ë°ì´í„°ì— í•©ì³ì§‘ë‹ˆë‹¤ (ë®ì–´ì“°ì§€ ì•ŠìŒ).</div>
    <div class="backup-btns">
      <button class="btn-backup btn-import" onclick="document.getElementById('import-file').click()">ğŸ“ JSON íŒŒì¼ ì—´ê¸°</button>
      <input type="file" id="import-file" accept=".json" style="display:none" onchange="importJSON(event)">
    </div>
    <div class="form-group" style="margin-top:4px">
      <div class="form-label">ë˜ëŠ” ê³µìœ  URL ë¶™ì—¬ë„£ê¸°</div>
      <div style="display:flex;gap:7px">
        <input class="form-input" id="import-url-input" placeholder="ê³µìœ  URLì„ ì—¬ê¸° ë¶™ì—¬ë„£ê¸°...">
        <button class="btn-sm green" onclick="importFromURL()">ì ìš©</button>
      </div>
    </div>
  </div>

  <!-- ì´ˆê¸°í™” -->
  <div class="backup-card">
    <div class="backup-card-title">ğŸ—‘ï¸ ë°ì´í„° ì´ˆê¸°í™”</div>
    <div class="backup-card-desc">ëª¨ë“  ë¬¸ì œë¥¼ ê¸°ë³¸ ë°ì´í„°ë¡œ ë˜ëŒë¦½ë‹ˆë‹¤. ë˜ëŒë¦´ ìˆ˜ ì—†ìœ¼ë‹ˆ ë¨¼ì € ë°±ì—…í•˜ì„¸ìš”.</div>
    <button class="btn-backup btn-reset" onclick="resetData()">âš ï¸ ê¸°ë³¸ê°’ìœ¼ë¡œ ì´ˆê¸°í™”</button>
  </div>
  <div style="height:6px"></div>
</div>

<!-- â•â•â•â•â•â•â•â• MODAL (ë¬¸ì œ ì¶”ê°€/ìˆ˜ì •) â•â•â•â•â•â•â•â• -->
<div id="modal-overlay">
  <div class="modal-box">
    <div class="modal-title" id="modal-title">ë¬¸ì œ ì¶”ê°€</div>
    <div class="form-group">
      <div class="form-label">ë¬¸ì œ</div>
      <textarea class="form-textarea" id="f-question" placeholder="ë¬¸ì œë¥¼ ì…ë ¥í•˜ì„¸ìš”" rows="2"></textarea>
    </div>
    <div class="form-group">
      <div class="form-label">ë¬¸ì œ ìœ í˜• (ì¹´í…Œê³ ë¦¬)</div>
      <select class="form-select" id="f-category"><!-- JS --></select>
    </div>
    <div class="form-group">
      <div class="form-label">ë‚œì´ë„</div>
      <select class="form-select" id="f-diff">
        <option value="easy">ğŸ˜Š ì‰¬ì›€</option>
        <option value="mid">ğŸ¤” ë³´í†µ</option>
        <option value="hard">ğŸ”¥ ì–´ë ¤ì›€</option>
      </select>
    </div>
    <div class="form-group" id="choices-form-group">
      <div class="form-label">ë³´ê¸° (ì •ë‹µ ë¼ë””ì˜¤ ì„ íƒ)</div>
      <div class="choices-grid">
        <div class="choice-row"><input type="radio" name="correct" value="0" id="r0"><label for="r0">â‘ </label><input class="form-input" id="f-c0" placeholder="ë³´ê¸° 1" style="flex:1"></div>
        <div class="choice-row"><input type="radio" name="correct" value="1" id="r1"><label for="r1">â‘¡</label><input class="form-input" id="f-c1" placeholder="ë³´ê¸° 2" style="flex:1"></div>
        <div class="choice-row"><input type="radio" name="correct" value="2" id="r2"><label for="r2">â‘¢</label><input class="form-input" id="f-c2" placeholder="ë³´ê¸° 3" style="flex:1"></div>
        <div class="choice-row"><input type="radio" name="correct" value="3" id="r3"><label for="r3">â‘£</label><input class="form-input" id="f-c3" placeholder="ë³´ê¸° 4" style="flex:1"></div>
      </div>
      <div class="form-hint">ë¼ë””ì˜¤ ë²„íŠ¼ìœ¼ë¡œ ì •ë‹µ ë³´ê¸°ë¥¼ ì„ íƒí•˜ë©´ ì •ë‹µë€ì— ìë™ ì…ë ¥ë©ë‹ˆë‹¤</div>
    </div>
    <div class="form-group">
      <div class="form-label">ì •ë‹µ</div>
      <input class="form-input" id="f-answer" placeholder="ì •ë‹µì„ ì§ì ‘ ì…ë ¥í•˜ê±°ë‚˜ ìœ„ì—ì„œ ë¼ë””ì˜¤ ì„ íƒ">
    </div>
    <div class="modal-btns">
      <button class="btn-modal-cancel" onclick="closeModal()">ì·¨ì†Œ</button>
      <button class="btn-modal-save" onclick="saveQuestion()">ì €ì¥í•˜ê¸° âœ“</button>
    </div>
  </div>
</div>

<!-- MODAL: ì¹´í…Œê³ ë¦¬ ì¶”ê°€ -->
<div id="modal-cat" style="display:none;position:fixed;inset:0;background:rgba(8,8,18,.9);backdrop-filter:blur(10px);z-index:300;align-items:flex-end;justify-content:center;">
  <div class="modal-box" style="border-radius:22px 22px 0 0">
    <div class="modal-title">ë¬¸ì œ ìœ í˜• ì¶”ê°€</div>
    <div class="form-group">
      <div class="form-label">ì´ëª¨ì§€</div>
      <input class="form-input" id="cat-emoji" placeholder="ì˜ˆ: ğŸ”¬" maxlength="2" style="font-size:20px;text-align:center;">
    </div>
    <div class="form-group">
      <div class="form-label">ìœ í˜• ì´ë¦„</div>
      <input class="form-input" id="cat-name" placeholder="ì˜ˆ: ê³¼í•™, ì—­ì‚¬, ìˆ˜í•™...">
    </div>
    <div class="modal-btns">
      <button class="btn-modal-cancel" onclick="closeCatModal()">ì·¨ì†Œ</button>
      <button class="btn-modal-save" onclick="saveCat()">ì¶”ê°€í•˜ê¸° âœ“</button>
    </div>
  </div>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  DEFAULT DATA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const DEFAULT_CATEGORIES = [
  {id:'science', name:'ê³¼í•™', emoji:'ğŸ”¬'},
  {id:'history', name:'ì—­ì‚¬', emoji:'ğŸ“œ'},
  {id:'general', name:'ìƒì‹', emoji:'ğŸŒ'},
  {id:'math',    name:'ìˆ˜í•™', emoji:'ğŸ”¢'},
  {id:'culture', name:'ë¬¸í™”/ì˜ˆìˆ ', emoji:'ğŸ¨'},
];

const DEFAULT_QUESTIONS = [
  // ê³¼í•™
  {q:"ëŒ€í•œë¯¼êµ­ì˜ ìˆ˜ë„ëŠ” ì–´ë””ì¸ê°€ìš”?",a:"ì„œìš¸",choices:["ì„œìš¸","ë¶€ì‚°","ëŒ€ì „","ê´‘ì£¼"],cat:"general",diff:"easy"},
  {q:"íƒœì–‘ê³„ì—ì„œ ê°€ì¥ í° í–‰ì„±ì€?",a:"ëª©ì„±",choices:["ì§€êµ¬","í† ì„±","ëª©ì„±","í•´ì™•ì„±"],cat:"science",diff:"easy"},
  {q:"ê³µê¸° ì¤‘ì— ê°€ì¥ ë§ì€ ê¸°ì²´ëŠ”?",a:"ì§ˆì†Œ",choices:["ì‚°ì†Œ","ì´ì‚°í™”íƒ„ì†Œ","ì§ˆì†Œ","ìˆ˜ì†Œ"],cat:"science",diff:"easy"},
  {q:"ë¬¼ì€ ì„­ì”¨ ëª‡ ë„ì—ì„œ ë“ë‚˜ìš”?",a:"ë°± ë„",choices:["ì˜¤ì‹­ ë„","íŒ”ì‹­ ë„","ë°± ë„","ë°±ì´ì‹­ ë„"],cat:"science",diff:"easy"},
  {q:"DNAì˜ ì´ì¤‘ ë‚˜ì„  êµ¬ì¡°ë¥¼ ë°œê²¬í•œ ê³¼í•™ìëŠ”?",a:"ì™“ìŠ¨ê³¼ í¬ë¦­",choices:["ì•„ì¸ìŠˆíƒ€ì¸","ì™“ìŠ¨ê³¼ í¬ë¦­","ë‹¤ìœˆ","íŒŒìŠ¤í‡´ë¥´"],cat:"science",diff:"mid"},
  {q:"ë¹›ì˜ ì†ë„ëŠ” ì´ˆì† ì•½ ì–¼ë§ˆì¸ê°€ìš”?",a:"30ë§Œ í‚¬ë¡œë¯¸í„°",choices:["3ë§Œ í‚¬ë¡œë¯¸í„°","30ë§Œ í‚¬ë¡œë¯¸í„°","300ë§Œ í‚¬ë¡œë¯¸í„°","3000ë§Œ í‚¬ë¡œë¯¸í„°"],cat:"science",diff:"mid"},
  {q:"ì¸ìŠë¦°ì„ ë¶„ë¹„í•˜ëŠ” ì¸ì²´ ê¸°ê´€ì€?",a:"ì·Œì¥",choices:["ê°„","ìœ„ì¥","ì·Œì¥","ì‹ ì¥"],cat:"science",diff:"mid"},
  {q:"ê´‘í•©ì„±ì´ ì¼ì–´ë‚˜ëŠ” ì„¸í¬ ì†Œê¸°ê´€ì€?",a:"ì—½ë¡ì²´",choices:["ë¯¸í† ì½˜ë“œë¦¬ì•„","ì—½ë¡ì²´","í•µ","ë¦¬ë³´ì†œ"],cat:"science",diff:"mid"},
  {q:"ì–‘ìì—­í•™ì—ì„œ ë¶ˆí™•ì •ì„± ì›ë¦¬ë¥¼ ì£¼ì¥í•œ ê³¼í•™ìëŠ”?",a:"í•˜ì´ì  ë² ë¥´í¬",choices:["ë³´ì–´","í•˜ì´ì  ë² ë¥´í¬","ìŠˆë¢°ë”©ê±°","ë””ë™"],cat:"science",diff:"hard"},
  {q:"í•­ìƒì œ í˜ë‹ˆì‹¤ë¦°ì„ ë°œê²¬í•œ ê³¼í•™ìëŠ”?",a:"ì•Œë ‰ì‚°ë” í”Œë ˆë°",choices:["ë£¨ì´ íŒŒìŠ¤í‡´ë¥´","ë¡œë² ë¥´íŠ¸ ì½”í","ì•Œë ‰ì‚°ë” í”Œë ˆë°","ì¡°ì§€í”„ ë¦¬ìŠ¤í„°"],cat:"science",diff:"hard"},
  {q:"ê´‘ì „ íš¨ê³¼ë¥¼ ì„¤ëª…í•˜ì—¬ ë…¸ë²¨ìƒì„ ë°›ì€ ê³¼í•™ìëŠ”?",a:"ì•„ì¸ìŠˆíƒ€ì¸",choices:["ë³´ì–´","í”Œë‘í¬","ì•„ì¸ìŠˆíƒ€ì¸","ëŸ¬ë”í¼ë“œ"],cat:"science",diff:"hard"},
  // ì—­ì‚¬
  {q:"í•œê¸€ì„ ë§Œë“  ì™•ì€?",a:"ì„¸ì¢…ëŒ€ì™•",choices:["íƒœì¡°","íƒœì¢…","ì„¸ì¢…ëŒ€ì™•","ì„±ì¢…"],cat:"history",diff:"easy"},
  {q:"ìš°ë¦¬ë‚˜ë¼ ìµœê³ ë´‰ì€?",a:"ë°±ë‘ì‚°",choices:["í•œë¼ì‚°","ì§€ë¦¬ì‚°","ì„¤ì•…ì‚°","ë°±ë‘ì‚°"],cat:"history",diff:"easy"},
  {q:"í•œêµ­ì „ìŸì´ ë°œë°œí•œ ì—°ë„ëŠ”?",a:"1950ë…„",choices:["1945ë…„","1948ë…„","1950ë…„","1953ë…„"],cat:"history",diff:"mid"},
  {q:"ê³ ë ¤ì‹œëŒ€ ê¸ˆì†í™œìë¡œ ì¸ì‡„ëœ ì„¸ê³„ ìµœì´ˆì˜ ì±…ì€?",a:"ì§ì§€ì‹¬ì²´ìš”ì ˆ",choices:["íŒ”ë§ŒëŒ€ì¥ê²½","ì§ì§€ì‹¬ì²´ìš”ì ˆ","ë™êµ­ì´ìƒêµ­ì§‘","ê³ ë ¤ëŒ€ì¥ê²½"],cat:"history",diff:"hard"},
  {q:"ì¡°ì„  í›„ê¸° ê±°ì¤‘ê¸°ë¥¼ ì„¤ê³„í•œ ì‹¤í•™ìëŠ”?",a:"ì •ì•½ìš©",choices:["ì´ìµ","í™ëŒ€ìš©","ì •ì•½ìš©","ë°•ì œê°€"],cat:"history",diff:"hard"},
  {q:"ì´í™©ê³¼ ì´ì´ì˜ ì‚¬ìƒ ë…¼ìŸì„ ê°€ë¦¬í‚¤ëŠ” ë§ì€?",a:"ì‚¬ì¹ ë…¼ìŸ",choices:["ì˜ˆì†¡ë…¼ìŸ","ì‚¬ì¹ ë…¼ìŸ","ë¶•ë‹¹ë…¼ìŸ","ì˜ˆí•™ë…¼ìŸ"],cat:"history",diff:"hard"},
  // ìƒì‹
  {q:"1ë…„ì€ ëª‡ ë‹¬ì¸ê°€ìš”?",a:"12ë‹¬",choices:["10ë‹¬","11ë‹¬","12ë‹¬","13ë‹¬"],cat:"general",diff:"easy"},
  {q:"ë¬´ì§€ê°œëŠ” ëª‡ ê°€ì§€ ìƒ‰ìœ¼ë¡œ ì´ë£¨ì–´ì ¸ ìˆë‚˜ìš”?",a:"7ê°€ì§€",choices:["5ê°€ì§€","6ê°€ì§€","7ê°€ì§€","8ê°€ì§€"],cat:"general",diff:"easy"},
  {q:"ì„¸ê³„ì—ì„œ ê°€ì¥ í° ëŒ€ë¥™ì€?",a:"ì•„ì‹œì•„",choices:["ìœ ëŸ½","ì•„í”„ë¦¬ì¹´","ì•„ì‹œì•„","ì•„ë©”ë¦¬ì¹´"],cat:"general",diff:"easy"},
  {q:"ì¸ì²´ì—ì„œ ê°€ì¥ í° ê¸°ê´€ì€?",a:"í”¼ë¶€",choices:["ê°„","í","ì‹¬ì¥","í”¼ë¶€"],cat:"general",diff:"mid"},
  {q:"ìœ ëŸ½ì—°í•© ë³¸ë¶€ê°€ ìˆëŠ” ë„ì‹œëŠ”?",a:"ë¸Œë¤¼ì…€",choices:["íŒŒë¦¬","ë² ë¥¼ë¦°","ë¸Œë¤¼ì…€","ëŸ°ë˜"],cat:"general",diff:"mid"},
  {q:"ì„¸ê³„ ìµœì´ˆì˜ ì¸ê³µìœ„ì„± ìŠ¤í‘¸íŠ¸ë‹ˆí¬ ì¼í˜¸ë¥¼ ë°œì‚¬í•œ ë‚˜ë¼ëŠ”?",a:"ì†Œë ¨",choices:["ë¯¸êµ­","ì†Œë ¨","ì¤‘êµ­","ë…ì¼"],cat:"general",diff:"hard"},
  {q:"ì„¸ê³„ ìµœì´ˆë¡œ ë…¸ë²¨ìƒì„ ë‘ ë²ˆ ë°›ì€ ê³¼í•™ìëŠ”?",a:"ë§ˆë¦¬ í€´ë¦¬",choices:["ì•„ì¸ìŠˆíƒ€ì¸","ë§ˆë¦¬ í€´ë¦¬","ë¼ì´ë„ˆìŠ¤ í´ë§","ì¡´ ë°”ë”˜"],cat:"general",diff:"hard"},
  // ìˆ˜í•™
  {q:"í”¼íƒ€ê³ ë¼ìŠ¤ ì •ë¦¬ì—ì„œ ì§ê°ì‚¼ê°í˜•ì˜ ë¹—ë³€ì„ cë¼ í•  ë•Œ ì„±ë¦½í•˜ëŠ” ì‹ì€?",a:"a ì œê³± ë”í•˜ê¸° b ì œê³± ë“±í˜¸ c ì œê³±",choices:["a ë”í•˜ê¸° b ë“±í˜¸ c","a ì œê³± ë”í•˜ê¸° b ì œê³± ë“±í˜¸ c ì œê³±","2a ë”í•˜ê¸° 2b ë“±í˜¸ c","a ê³±í•˜ê¸° b ë“±í˜¸ c"],cat:"math",diff:"mid"},
  {q:"ì›ì˜ ë„“ì´ë¥¼ êµ¬í•˜ëŠ” ê³µì‹ì€? ë°˜ì§€ë¦„ì„ rì´ë¼ í•  ë•Œ",a:"íŒŒì´ r ì œê³±",choices:["2 íŒŒì´ r","íŒŒì´ r ì œê³±","íŒŒì´ r","2 íŒŒì´ r ì œê³±"],cat:"math",diff:"mid"},
  {q:"1ë¶€í„° 100ê¹Œì§€ ìì—°ìˆ˜ì˜ í•©ì€?",a:"5050",choices:["4950","5000","5050","5100"],cat:"math",diff:"mid"},
  // ë¬¸í™”/ì˜ˆìˆ 
  {q:"ì„¸ìµìŠ¤í”¼ì–´ì˜ 4ëŒ€ ë¹„ê·¹ì´ ì•„ë‹Œ ê²ƒì€?",a:"ë¡œë¯¸ì˜¤ì™€ ì¤„ë¦¬ì—£",choices:["í–„ë¦¿","ì˜¤ì…€ë¡œ","ë¦¬ì–´ì™•","ë¡œë¯¸ì˜¤ì™€ ì¤„ë¦¬ì—£"],cat:"culture",diff:"mid"},
  {q:"ì¡´ì¬ëŠ” ë³¸ì§ˆì— ì•ì„ ë‹¤ê³  ì£¼ì¥í•œ ì‹¤ì¡´ì£¼ì˜ ì² í•™ìëŠ”?",a:"ì‚¬ë¥´íŠ¸ë¥´",choices:["í•˜ì´ë°ê±°","ë‹ˆì²´","ì‚¬ë¥´íŠ¸ë¥´","ì¹´ë®ˆ"],cat:"culture",diff:"hard"},
  {q:"ì¹¸íŠ¸ì˜ 3ëŒ€ ë¹„íŒì„œê°€ ì•„ë‹Œ ê²ƒì€?",a:"ì—­ì‚¬ì´ì„±ë¹„íŒ",choices:["ìˆœìˆ˜ì´ì„±ë¹„íŒ","ì‹¤ì²œì´ì„±ë¹„íŒ","íŒë‹¨ë ¥ë¹„íŒ","ì—­ì‚¬ì´ì„±ë¹„íŒ"],cat:"culture",diff:"hard"},
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  STORAGE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const SK_Q   = 'quizQuestions_v3';
const SK_CAT = 'quizCategories_v3';

function loadDB(){
  try{
    const q=localStorage.getItem(SK_Q);
    const c=localStorage.getItem(SK_CAT);
    return {
      questions: q ? JSON.parse(q) : JSON.parse(JSON.stringify(DEFAULT_QUESTIONS)),
      categories: c ? JSON.parse(c) : JSON.parse(JSON.stringify(DEFAULT_CATEGORIES))
    };
  }catch(e){
    return {questions:JSON.parse(JSON.stringify(DEFAULT_QUESTIONS)),categories:JSON.parse(JSON.stringify(DEFAULT_CATEGORIES))};
  }
}
function saveDB(){
  localStorage.setItem(SK_Q, JSON.stringify(DB.questions));
  localStorage.setItem(SK_CAT, JSON.stringify(DB.categories));
}

let DB = loadDB();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SETTINGS & STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let settings = {wait:3, diff:'all', type:'multi', cat:'all'};
let state = {questions:[],idx:0,score:0,correctCount:0,wrongCount:0,phase:'idle',paused:false,timerInterval:null,timerCount:0,timerTotal:0};
const CIRC = 194.78;

// â”€â”€ setting buttons â”€â”€
document.querySelectorAll('.btn-opt').forEach(btn=>{
  btn.addEventListener('click',()=>{
    const g=btn.dataset.group;
    document.querySelectorAll(`.btn-opt[data-group="${g}"]`).forEach(b=>b.classList.remove('selected'));
    btn.classList.add('selected');
    if(g==='wait') settings.wait=parseInt(btn.dataset.val);
    if(g==='diff') settings.diff=btn.dataset.val;
    if(g==='type') settings.type=btn.dataset.val;
  });
});

// â”€â”€ home category chips â”€â”€
function renderHomeCats(){
  const sc=document.getElementById('home-cat-scroll');
  sc.innerHTML=`<button class="cat-chip all-chip ${settings.cat==='all'?'selected':''}" onclick="selectHomeCat('all')">ğŸ² ì „ì²´</button>`;
  DB.categories.forEach(c=>{
    sc.innerHTML+=`<button class="cat-chip ${settings.cat===c.id?'selected':''}" onclick="selectHomeCat('${c.id}')">${c.emoji} ${c.name}</button>`;
  });
}
function selectHomeCat(id){
  settings.cat=id;
  renderHomeCats();
}

// â”€â”€ show screen â”€â”€
function showScreen(id){
  stopSpeech(); clearInterval(state.timerInterval);
  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  if(id==='screen-editor') renderEditor();
  if(id==='screen-backup') renderBackupStats();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  START QUIZ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function startQuiz(){
  let pool=[...DB.questions];
  if(settings.cat!=='all') pool=pool.filter(q=>q.cat===settings.cat);
  if(settings.diff!=='all') pool=pool.filter(q=>q.diff===settings.diff);
  if(pool.length===0){showToast('âš ï¸ í•´ë‹¹ ì¡°ê±´ì˜ ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤!');return;}
  for(let i=pool.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[pool[i],pool[j]]=[pool[j],pool[i]];}
  state.questions=pool.slice(0,Math.min(10,pool.length));
  state.idx=0;state.score=0;state.correctCount=0;state.wrongCount=0;
  state.paused=false;
  document.getElementById('btn-pause').textContent='â¸';
  document.getElementById('pause-overlay').classList.remove('active');
  showScreen('screen-quiz');
  loadQuestion();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  QUIZ LOGIC
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function loadQuestion(){
  clearInterval(state.timerInterval);
  const q=state.questions[state.idx];
  const total=state.questions.length;
  document.getElementById('progress-text').textContent=`${state.idx+1} / ${total}`;
  document.getElementById('progress-fill').style.width=`${(state.idx/total)*100}%`;
  document.getElementById('q-num').textContent=`Q${state.idx+1}`;
  // category badge
  const catObj=DB.categories.find(c=>c.id===q.cat);
  const catBadge=document.getElementById('q-cat-badge');
  catBadge.textContent=catObj?`${catObj.emoji} ${catObj.name}`:'';
  // diff badge
  const db=document.getElementById('q-diff-badge');
  const dm={easy:['ì‰¬ì›€','diff-easy'],mid:['ë³´í†µ','diff-mid'],hard:['ì–´ë ¤ì›€','diff-hard']};
  db.textContent=dm[q.diff][0]; db.className=`q-diff-badge ${dm[q.diff][1]}`;
  document.getElementById('q-text').textContent=q.q;
  const banner=document.getElementById('status-banner');
  banner.style.display='none';banner.className='status-banner';
  document.getElementById('btn-next').style.display='none';
  setArc(1,'var(--accent)');setTimerNum('â€“');
  document.getElementById('timer-phase-label').textContent='ë¬¸ì œ ì½ëŠ” ì¤‘';
  const cw=document.getElementById('choices-wrap');
  const sw=document.getElementById('short-wrap');
  if(settings.type==='multi'){
    cw.style.display='flex';sw.style.display='none';
    const sh=[...q.choices].sort(()=>Math.random()-.5);
    q._sh=sh;
    const letters=['â‘ ','â‘¡','â‘¢','â‘£'];
    for(let i=0;i<4;i++){
      const btn=document.getElementById(`c${i}`);
      btn.querySelector('.choice-letter').textContent=letters[i];
      btn.querySelector('.choice-text').textContent=sh[i];
      btn.className='choice-btn';btn.disabled=true;
    }
  }else{
    cw.style.display='none';sw.style.display='flex';
    const rev=document.getElementById('answer-reveal');
    rev.textContent='? ? ?';rev.className='answer-reveal';
  }
  state.phase='reading';
  speak(`${state.idx+1}ë²ˆ ë¬¸ì œ. ${q.q}`,()=>{
    if(state.phase!=='reading')return;
    state.phase='waiting';
    startCountdown(settings.wait,()=>revealAnswer());
  });
}

function startCountdown(sec,onDone){
  document.getElementById('timer-phase-label').textContent='ìƒê°í•˜ëŠ” ì‹œê°„!';
  if(settings.type==='multi') for(let i=0;i<4;i++) document.getElementById(`c${i}`).disabled=false;
  state.timerCount=sec;state.timerTotal=sec;
  setArc(1,'var(--accent)');setTimerNum(sec);
  clearInterval(state.timerInterval);
  state.timerInterval=setInterval(()=>{
    if(state.paused)return;
    state.timerCount--;
    const r=state.timerCount/state.timerTotal;
    setTimerNum(state.timerCount<=0?0:state.timerCount);
    setArc(r>0?r:0,r>.5?'var(--accent)':r>.25?'var(--accent2)':'var(--red)');
    if(state.timerCount<=0){clearInterval(state.timerInterval);onDone();}
  },1000);
}
function setArc(ratio,color){
  const arc=document.getElementById('timer-arc');
  arc.style.strokeDashoffset=CIRC*(1-Math.max(0,Math.min(1,ratio)));
  arc.style.stroke=color;
}
function setTimerNum(v){document.getElementById('timer-number').textContent=v;}

function revealAnswer(){
  clearInterval(state.timerInterval);state.phase='revealing';
  document.getElementById('timer-phase-label').textContent='ì •ë‹µ ê³µê°œ!';
  setTimerNum('âœ“');setArc(1,'var(--green)');
  const q=state.questions[state.idx];
  if(settings.type==='multi'){
    for(let i=0;i<4;i++){const btn=document.getElementById(`c${i}`);btn.disabled=true;if(q._sh[i]===q.a)btn.classList.add('correct');}
  }else{
    const rev=document.getElementById('answer-reveal');rev.textContent=q.a;rev.classList.add('shown');
  }
  showBanner(`âœ… ì •ë‹µ: ${q.a}`,'info-banner');
  document.getElementById('btn-next').style.display='block';
  speak(`ì •ë‹µì€ ${q.a} ì…ë‹ˆë‹¤.`,null);
}

function selectChoice(idx){
  if(state.phase!=='waiting')return;
  clearInterval(state.timerInterval);state.phase='revealing';
  const q=state.questions[state.idx];
  const correct=q._sh[idx]===q.a;
  for(let i=0;i<4;i++){const btn=document.getElementById(`c${i}`);btn.disabled=true;if(q._sh[i]===q.a)btn.classList.add('correct');}
  if(!correct)document.getElementById(`c${idx}`).classList.add('wrong');
  if(correct){state.correctCount++;state.score+=10;showBanner('ğŸ‰ ì •ë‹µì…ë‹ˆë‹¤!','correct-banner');setArc(1,'var(--green)');speak('ì •ë‹µì…ë‹ˆë‹¤!',null);}
  else{state.wrongCount++;showBanner(`âŒ ì˜¤ë‹µ! ì •ë‹µì€ ${q.a}`,'wrong-banner');setArc(1,'var(--red)');speak(`ì˜¤ë‹µì…ë‹ˆë‹¤. ì •ë‹µì€ ${q.a} ì…ë‹ˆë‹¤.`,null);}
  setTimerNum(correct?'âœ“':'âœ—');
  document.getElementById('timer-phase-label').textContent=correct?'ì •ë‹µ!':'ì˜¤ë‹µ!';
  document.getElementById('btn-next').style.display='block';
}

function nextQuestion(){
  stopSpeech();state.idx++;
  if(state.idx>=state.questions.length)endQuiz();else loadQuestion();
}

function endQuiz(){
  clearInterval(state.timerInterval);
  const total=state.questions.length;
  const pct=Math.round((state.correctCount/total)*100);
  document.getElementById('result-score').textContent=`${state.score}ì `;
  document.getElementById('stat-correct').textContent=state.correctCount;
  document.getElementById('stat-wrong').textContent=state.wrongCount;
  document.getElementById('stat-pct').textContent=`${pct}%`;
  document.getElementById('result-sub').textContent=`${total}ë¬¸ì œ ì¤‘ ${state.correctCount}ê°œ ì •ë‹µ!`;
  const e=pct===100?'ğŸ†':pct>=80?'ğŸ¥‡':pct>=60?'ğŸ¥ˆ':pct>=40?'ğŸ¥‰':'ğŸ˜…';
  document.getElementById('result-emoji').textContent=e;
  showScreen('screen-result');
  speak(`í€´ì¦ˆê°€ ëë‚¬ìŠµë‹ˆë‹¤! ì´ ${total}ë¬¸ì œ ì¤‘ ${state.correctCount}ë¬¸ì œë¥¼ ë§í˜”ìŠµë‹ˆë‹¤. ${state.score}ì !`,null);
}
function restartQuiz(){showScreen('screen-home');}
function togglePause(){
  state.paused=!state.paused;
  document.getElementById('pause-overlay').classList.toggle('active',state.paused);
  document.getElementById('btn-pause').textContent=state.paused?'â–¶':'â¸';
  if(state.paused)window.speechSynthesis&&window.speechSynthesis.pause();
  else window.speechSynthesis&&window.speechSynthesis.resume();
}
function showBanner(msg,cls){
  const b=document.getElementById('status-banner');
  b.textContent=msg;b.className=`status-banner ${cls}`;b.style.display='block';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  TTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let selectedVoice=null;
let allKoVoices=[];

function loadVoices(){
  const voices=window.speechSynthesis.getVoices();
  let ko=voices.filter(v=>v.lang.startsWith('ko'));
  if(ko.length===0)ko=voices;
  ko.sort((a,b)=>{
    const sc=v=>{const n=v.name.toLowerCase();if(n.includes('google'))return 4;if(n.includes('microsoft'))return 3;if(n.includes('yuna')||n.includes('apple')||n.includes('siri'))return 3;return 1;};
    return sc(b)-sc(a);
  });
  allKoVoices=ko;
  const sel=document.getElementById('voice-select');
  sel.innerHTML='';
  ko.forEach((v,i)=>{
    const opt=document.createElement('option');opt.value=i;
    const star=(v.name.toLowerCase().includes('google')||v.name.toLowerCase().includes('microsoft')||v.name.toLowerCase().includes('yuna'))?'â˜… ':'';
    opt.textContent=star+v.name;
    sel.appendChild(opt);
  });
  if(ko.length>0)selectedVoice=ko[0];
}
document.getElementById('voice-select').addEventListener('change',function(){selectedVoice=allKoVoices[parseInt(this.value)]||null;});
function testVoice(){speak('ì•ˆë…•í•˜ì„¸ìš”! ìƒì‹ í€´ì¦ˆ ìŒì„± í…ŒìŠ¤íŠ¸ì…ë‹ˆë‹¤. ì˜ ë“¤ë¦¬ì‹œë‚˜ìš”?',null);}
if(window.speechSynthesis){window.speechSynthesis.onvoiceschanged=loadVoices;loadVoices();}

function stopSpeech(){
  window.speechSynthesis&&window.speechSynthesis.cancel();
  const dot=document.getElementById('tts-dot');
  const lbl=document.getElementById('tts-label');
  if(dot)dot.classList.remove('speaking');
  if(lbl)lbl.textContent='ëŒ€ê¸° ì¤‘';
}
function speak(text,onEnd){
  if(!window.speechSynthesis){onEnd&&onEnd();return;}
  stopSpeech();
  const cleaned=fixPron(text);
  const u=new SpeechSynthesisUtterance(cleaned);
  u.lang='ko-KR';u.rate=0.88;u.pitch=1.0;u.volume=1.0;
  if(selectedVoice)u.voice=selectedVoice;
  const dot=document.getElementById('tts-dot');
  const lbl=document.getElementById('tts-label');
  u.onstart=()=>{dot&&dot.classList.add('speaking');if(lbl)lbl.textContent='ì½ëŠ” ì¤‘';};
  u.onend=()=>{dot&&dot.classList.remove('speaking');if(lbl)lbl.textContent='ëŒ€ê¸° ì¤‘';onEnd&&onEnd();};
  u.onerror=()=>{dot&&dot.classList.remove('speaking');if(lbl)lbl.textContent='ëŒ€ê¸° ì¤‘';onEnd&&onEnd();};
  setTimeout(()=>window.speechSynthesis.speak(u),80);
}
function fixPron(t){
  return t
    .replace(/DNA/g,'ë””ì—”ì—ì´').replace(/RNA/g,'ì•Œì—”ì—ì´').replace(/pH/g,'í”¼ì—ì´ì¹˜')
    .replace(/EU/g,'ì´ìœ ').replace(/AI/g,'ì—ì´ì•„ì´').replace(/IT/g,'ì•„ì´í‹°')
    .replace(/Â²/g,' ì œê³±').replace(/Â³/g,' ì„¸ì œê³±')
    .replace(/\bFe\b/g,'ì—í”„ì´').replace(/\bIr\b/g,'ì•„ì´ì•Œ').replace(/\bIn\b/g,'ì•„ì´ì—”').replace(/\bF\b/g,'ì—í”„')
    .replace(/km/g,'í‚¬ë¡œë¯¸í„°').replace(/m\b/g,'ë¯¸í„°');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  EDITOR
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let edCat='all';
let edDiff='all';
let editingIdx=null;

function renderEditor(){
  renderEditorCatBar();
  renderEditorList();
}
function renderEditorCatBar(){
  const bar=document.getElementById('editor-cat-bar');
  bar.innerHTML=`<button class="editor-cat-tag ${edCat==='all'?'active':''}" onclick="switchEdCat('all')">ğŸ² ì „ì²´</button>`;
  DB.categories.forEach(c=>{
    bar.innerHTML+=`
      <button class="editor-cat-tag ${edCat===c.id?'active':''}" onclick="switchEdCat('${c.id}')">
        ${c.emoji} ${c.name}
        <span class="del-tag" onclick="event.stopPropagation();deleteCat('${c.id}')">âœ•</span>
      </button>`;
  });
}
function switchEdCat(id){edCat=id;renderEditor();}
function switchEdDiff(d){
  edDiff=d;
  document.querySelectorAll('.diff-tab').forEach(t=>t.classList.toggle('active',t.dataset.ediff===d));
  renderEditorList();
}
function renderEditorList(){
  const list=document.getElementById('editor-list');
  let qs=[...DB.questions];
  if(edCat!=='all')qs=qs.filter(q=>q.cat===edCat);
  if(edDiff!=='all')qs=qs.filter(q=>q.diff===edDiff);
  // store filtered indices mapped to original
  list._filteredIds=qs.map(q=>DB.questions.indexOf(q));
  if(qs.length===0){
    list.innerHTML=`<div class="empty-state"><div class="empty-icon">ğŸ“­</div>ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤.<br>ì•„ë˜ ë²„íŠ¼ìœ¼ë¡œ ì¶”ê°€í•´ ë³´ì„¸ìš”!</div>`;
    return;
  }
  const diffLabel={easy:'ì‰¬ì›€',mid:'ë³´í†µ',hard:'ì–´ë ¤ì›€'};
  list.innerHTML=qs.map((q,fi)=>{
    const catObj=DB.categories.find(c=>c.id===q.cat);
    const origIdx=DB.questions.indexOf(q);
    return `
    <div class="q-item">
      <div class="q-item-num">${fi+1}</div>
      <div class="q-item-body">
        <div class="q-item-q">${esc(q.q)}</div>
        <div class="q-item-meta">
          <span class="q-item-a">âœ“ ${esc(q.a)}</span>
          ${catObj?`<span class="q-item-cat">${catObj.emoji} ${catObj.name}</span>`:''}
          <span class="q-item-diff ${q.diff}">${diffLabel[q.diff]||q.diff}</span>
        </div>
      </div>
      <div class="q-item-actions">
        <button class="btn-icon" onclick="openModal(${origIdx})" title="ìˆ˜ì •">âœï¸</button>
        <button class="btn-icon del" onclick="deleteQuestion(${origIdx})" title="ì‚­ì œ">ğŸ—‘ï¸</button>
      </div>
    </div>`;
  }).join('');
}
function esc(s){return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');}
function deleteQuestion(idx){
  if(!confirm(`ì´ ë¬¸ì œë¥¼ ì‚­ì œí• ê¹Œìš”?\n"${DB.questions[idx].q.slice(0,30)}..."`))return;
  DB.questions.splice(idx,1);saveDB();renderEditorList();showToast('ğŸ—‘ï¸ ì‚­ì œëìŠµë‹ˆë‹¤');
}

// â”€â”€ CATEGORY â”€â”€
function openAddCatModal(){
  document.getElementById('cat-emoji').value='';
  document.getElementById('cat-name').value='';
  document.getElementById('modal-cat').style.display='flex';
}
function closeCatModal(){document.getElementById('modal-cat').style.display='none';}
function saveCat(){
  const emoji=document.getElementById('cat-emoji').value.trim()||'ğŸ“Œ';
  const name=document.getElementById('cat-name').value.trim();
  if(!name){alert('ìœ í˜• ì´ë¦„ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.');return;}
  const id='cat_'+Date.now();
  DB.categories.push({id,name,emoji});
  saveDB();closeCatModal();renderEditor();renderHomeCats();showToast('âœ… ìœ í˜•ì´ ì¶”ê°€ëìŠµë‹ˆë‹¤');
}
function deleteCat(id){
  const cat=DB.categories.find(c=>c.id===id);
  if(!cat)return;
  const count=DB.questions.filter(q=>q.cat===id).length;
  if(!confirm(`"${cat.emoji} ${cat.name}" ìœ í˜•ì„ ì‚­ì œí• ê¹Œìš”?\nì´ ìœ í˜•ì˜ ë¬¸ì œ ${count}ê°œëŠ” ì¹´í…Œê³ ë¦¬ê°€ 'ìƒì‹'ìœ¼ë¡œ ë³€ê²½ë©ë‹ˆë‹¤.`))return;
  DB.questions.forEach(q=>{if(q.cat===id)q.cat='general';});
  DB.categories=DB.categories.filter(c=>c.id!==id);
  if(edCat===id)edCat='all';
  saveDB();renderEditor();renderHomeCats();showToast('ğŸ—‘ï¸ ìœ í˜•ì´ ì‚­ì œëìŠµë‹ˆë‹¤');
}

// â”€â”€ MODAL â”€â”€
function populateCatSelect(){
  const sel=document.getElementById('f-category');
  sel.innerHTML=DB.categories.map(c=>`<option value="${c.id}">${c.emoji} ${c.name}</option>`).join('');
}
function openModal(idx){
  editingIdx=idx;
  populateCatSelect();
  document.getElementById('modal-title').textContent=idx!==null?'ë¬¸ì œ ìˆ˜ì •':'ë¬¸ì œ ì¶”ê°€';
  if(idx!==null){
    const q=DB.questions[idx];
    document.getElementById('f-question').value=q.q;
    document.getElementById('f-answer').value=q.a;
    document.getElementById('f-diff').value=q.diff||'easy';
    document.getElementById('f-category').value=q.cat||DB.categories[0]?.id||'';
    (q.choices||[]).forEach((c,i)=>{document.getElementById(`f-c${i}`).value=c;});
    // set correct radio
    const ci=(q.choices||[]).indexOf(q.a);
    document.querySelectorAll('input[name="correct"]').forEach(r=>r.checked=false);
    if(ci>=0)document.getElementById(`r${ci}`).checked=true;
  }else{
    document.getElementById('f-question').value='';
    document.getElementById('f-answer').value='';
    document.getElementById('f-diff').value='easy';
    if(edCat!=='all')document.getElementById('f-category').value=edCat;
    for(let i=0;i<4;i++)document.getElementById(`f-c${i}`).value='';
    document.querySelectorAll('input[name="correct"]').forEach(r=>r.checked=false);
  }
  document.getElementById('modal-overlay').classList.add('active');
}
function closeModal(){document.getElementById('modal-overlay').classList.remove('active');}

// auto-fill answer when radio selected
document.querySelectorAll('input[name="correct"]').forEach(r=>{
  r.addEventListener('change',()=>{
    const val=document.getElementById(`f-c${r.value}`).value.trim();
    if(val)document.getElementById('f-answer').value=val;
  });
});
for(let i=0;i<4;i++){
  document.getElementById(`f-c${i}`).addEventListener('input',function(){
    if(document.getElementById(`r${i}`).checked)document.getElementById('f-answer').value=this.value;
  });
}

function saveQuestion(){
  const q=document.getElementById('f-question').value.trim();
  const a=document.getElementById('f-answer').value.trim();
  const cat=document.getElementById('f-category').value;
  const diff=document.getElementById('f-diff').value;
  const choices=[0,1,2,3].map(i=>document.getElementById(`f-c${i}`).value.trim());
  if(!q){alert('ë¬¸ì œë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.');return;}
  if(!a){alert('ì •ë‹µì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.');return;}
  if(choices.some(c=>!c)){alert('ë³´ê¸° 4ê°œë¥¼ ëª¨ë‘ ì…ë ¥í•´ ì£¼ì„¸ìš”.');return;}
  const obj={q,a,choices,cat,diff};
  if(editingIdx!==null){DB.questions[editingIdx]=obj;}
  else{DB.questions.push(obj);}
  saveDB();closeModal();renderEditorList();
  showToast(editingIdx!==null?'âœ… ë¬¸ì œê°€ ìˆ˜ì •ëìŠµë‹ˆë‹¤':'âœ… ë¬¸ì œê°€ ì¶”ê°€ëìŠµë‹ˆë‹¤');
}
document.getElementById('modal-overlay').addEventListener('click',function(e){if(e.target===this)closeModal();});
document.getElementById('modal-cat').addEventListener('click',function(e){if(e.target===this)closeCatModal();});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  BACKUP / EXPORT / IMPORT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderBackupStats(){
  const g=document.getElementById('stats-grid');
  const total=DB.questions.length;
  const byCat=DB.categories.map(c=>({name:c.emoji+' '+c.name,count:DB.questions.filter(q=>q.cat===c.id).length}));
  g.innerHTML=`
    <div class="stats-item"><div class="stats-val">${total}</div><div class="stats-key">ì „ì²´ ë¬¸ì œ</div></div>
    <div class="stats-item"><div class="stats-val">${DB.categories.length}</div><div class="stats-key">ë¬¸ì œ ìœ í˜•</div></div>
    ${byCat.map(c=>`<div class="stats-item"><div class="stats-val">${c.count}</div><div class="stats-key">${c.name}</div></div>`).join('')}
  `;
}

function exportJSON(){
  const data={categories:DB.categories,questions:DB.questions,exportedAt:new Date().toISOString()};
  const blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'});
  const url=URL.createObjectURL(blob);
  const a=document.createElement('a');
  a.href=url;a.download=`quiz_backup_${new Date().toISOString().slice(0,10)}.json`;
  a.click();URL.revokeObjectURL(url);
  showToast('ğŸ“ JSON íŒŒì¼ì´ ì €ì¥ëìŠµë‹ˆë‹¤');
}

function genShareURL(){
  const data={categories:DB.categories,questions:DB.questions};
  const json=JSON.stringify(data);
  const b64=btoa(unescape(encodeURIComponent(json)));
  const url=location.href.split('?')[0]+'?d='+b64;
  document.getElementById('share-url-box').textContent=url;
  document.getElementById('share-url-wrap').style.display='flex';
  if(url.length>50000){
    document.getElementById('share-url-box').textContent='âš ï¸ ë°ì´í„°ê°€ ë„ˆë¬´ ì»¤ì„œ URLë¡œ ê³µìœ í•˜ê¸° ì–´ë µìŠµë‹ˆë‹¤. JSON íŒŒì¼ë¡œ ë‚´ë³´ë‚´ê¸°ë¥¼ ì´ìš©í•´ ì£¼ì„¸ìš”.';
  }
}
function copyShareURL(){
  const url=document.getElementById('share-url-box').textContent;
  navigator.clipboard.writeText(url).then(()=>showToast('ğŸ“‹ URLì´ ë³µì‚¬ëìŠµë‹ˆë‹¤!')).catch(()=>{
    // fallback
    const ta=document.createElement('textarea');ta.value=url;document.body.appendChild(ta);ta.select();document.execCommand('copy');document.body.removeChild(ta);
    showToast('ğŸ“‹ URLì´ ë³µì‚¬ëìŠµë‹ˆë‹¤!');
  });
}

function importJSON(event){
  const file=event.target.files[0];if(!file)return;
  const reader=new FileReader();
  reader.onload=e=>{
    try{
      const data=JSON.parse(e.target.result);
      mergeData(data);
    }catch(err){alert('JSON íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');}
  };
  reader.readAsText(file);
  event.target.value='';
}
function importFromURL(){
  const input=document.getElementById('import-url-input').value.trim();
  try{
    let b64=input;
    if(input.includes('?d='))b64=input.split('?d=')[1];
    const json=decodeURIComponent(escape(atob(b64)));
    const data=JSON.parse(json);
    mergeData(data);
    document.getElementById('import-url-input').value='';
  }catch(e){alert('ì˜¬ë°”ë¥¸ ê³µìœ  URLì´ ì•„ë‹™ë‹ˆë‹¤.');}
}
function mergeData(data){
  let addedCats=0,addedQs=0;
  // merge categories
  if(data.categories){
    data.categories.forEach(c=>{
      if(!DB.categories.find(e=>e.id===c.id)){DB.categories.push(c);addedCats++;}
    });
  }
  // merge questions (avoid exact duplicates)
  if(data.questions){
    data.questions.forEach(q=>{
      const dup=DB.questions.find(e=>e.q===q.q&&e.a===q.a);
      if(!dup){DB.questions.push(q);addedQs++;}
    });
  }
  saveDB();renderHomeCats();
  showToast(`âœ… ìœ í˜• ${addedCats}ê°œ, ë¬¸ì œ ${addedQs}ê°œ ì¶”ê°€ëìŠµë‹ˆë‹¤`);
  renderBackupStats();
}

function resetData(){
  if(!confirm('ì •ë§ ì´ˆê¸°í™”í• ê¹Œìš”?\nëª¨ë“  ë¬¸ì œê°€ ê¸°ë³¸ê°’ìœ¼ë¡œ ë˜ëŒì•„ê°‘ë‹ˆë‹¤.\në¨¼ì € JSON íŒŒì¼ë¡œ ë°±ì—…í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.'))return;
  DB={questions:JSON.parse(JSON.stringify(DEFAULT_QUESTIONS)),categories:JSON.parse(JSON.stringify(DEFAULT_CATEGORIES))};
  saveDB();renderHomeCats();renderBackupStats();showToast('ğŸ”„ ì´ˆê¸°í™”ëìŠµë‹ˆë‹¤');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  TOAST
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let toastTimer=null;
function showToast(msg){
  const t=document.getElementById('toast');
  t.textContent=msg;t.classList.add('show');
  clearTimeout(toastTimer);
  toastTimer=setTimeout(()=>t.classList.remove('show'),2600);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  URL IMPORT ON LOAD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
(function checkURLData(){
  const p=new URLSearchParams(location.search);
  const d=p.get('d');
  if(!d)return;
  try{
    const json=decodeURIComponent(escape(atob(d)));
    const data=JSON.parse(json);
    if(confirm('ê³µìœ ëœ ë¬¸ì œ ë°ì´í„°ê°€ ìˆìŠµë‹ˆë‹¤. ë¶ˆëŸ¬ì˜¬ê¹Œìš”?\n(ê¸°ì¡´ ë°ì´í„°ì— í•©ì³ì§‘ë‹ˆë‹¤)')){
      mergeData(data);
    }
    // clean URL
    history.replaceState({},'',location.pathname);
  }catch(e){}
})();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
renderHomeCats();
</script>
</body>
</html>
